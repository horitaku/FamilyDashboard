# ğŸ¥œ FamilyDashboard docker-compose.yml
# ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’æ°¸ç¶šåŒ–ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã¾ã™ï¼

version: '3.8'

services:
  familydashboard:
    # ã‚¤ãƒ¡ãƒ¼ã‚¸åã¨ã‚¿ã‚°
    image: familydashboard:latest
    
    # ã‚³ãƒ³ãƒ†ãƒŠå
    container_name: familydashboard
    
    # ãƒ“ãƒ«ãƒ‰è¨­å®šï¼ˆDockerfileã‹ã‚‰ãƒ“ãƒ«ãƒ‰ï¼‰
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/arm64  # Raspberry Pi 5 å‘ã‘
    
    # ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆãƒ›ã‚¹ãƒˆã®8080 â†’ ã‚³ãƒ³ãƒ†ãƒŠã®8080ï¼‰
    ports:
      - "8080:8080"
    
    # ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆï¼ˆdata ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ°¸ç¶šåŒ–ï¼‰
    volumes:
      - ./data:/app/data
    
    # ç’°å¢ƒå¤‰æ•°ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¨­å®šï¼‰
    environment:
      - TZ=Asia/Tokyo
      - FRONTEND_DIST_PATH=/app/frontend/dist
      # Google OAuth è¨­å®šï¼ˆsettings.json ã§ç®¡ç†ï¼‰
      # - GOOGLE_CLIENT_ID=your-client-id
      # - GOOGLE_CLIENT_SECRET=your-client-secret
    
    # å†èµ·å‹•ãƒãƒªã‚·ãƒ¼ï¼ˆå¸¸ã«å†èµ·å‹•ï¼‰
    restart: unless-stopped
    
    # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆ/api/status ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ç¢ºèªï¼‰
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/api/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    
    # ãƒ­ã‚°è¨­å®šï¼ˆãƒ­ã‚°ã‚µã‚¤ã‚ºã‚’åˆ¶é™ï¼‰
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# ãƒœãƒªãƒ¥ãƒ¼ãƒ å®šç¾©ï¼ˆå¿…è¦ã«å¿œã˜ã¦åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ä½¿ç”¨ï¼‰
# volumes:
#   data:
#     driver: local
