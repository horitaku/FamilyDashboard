# 🥜 FamilyDashboard 実装計画（アーニャ予実管理リニューアル案）

うい！アーニャが予実管理しやすい計画をつくるます！わくわく！✨

---

## 🥜 タスク一覧（チェックリスト）

- [x] 1. プロジェクト初期セットアップ
- [x] 2. バックエンドAPIの基礎
- [x] 3. キャッシュ機構の実装
- [x] 4. 設定管理
- [x] 5. ジオコーディング（Nominatim）
- [x] 6. 天気APIクライアント
- [ ] 7. Googleカレンダー/タスクAPIクライアント
- [ ] 8. APIエラー・オフライン対応
- [ ] 9. フロントエンド（Svelte）実装
- [ ] 10. エラーUI・点滅インジケーター
- [ ] 11. 本番用ビルド・デプロイ
- [ ] 12. 追加・改善・リファクタリング

---

## 🥜 進捗管理表

| ステップ | 担当 | 開始日 | 完了日 | 状況 | メモ |
|:---|:---|:---|:---|:---|:---|
| 1. 初期セットアップ | アーニャ | 2026-02-14 | 2026-02-14 | 完了 | Go初期化、Gin雛形、Svelte初期化、設定/README/.gitignore整備 |
| 2. API基礎 | アーニャ | 2026-02-14 | 2026-02-14 | 完了 | /api/status, /api/calendar, /api/tasks, /api/weather エンドポイント実装、ダミーデータでレスポンス確認 |
| 3. キャッシュ | アーニャ | 2026-02-14 | 2026-02-14 | 完了 | JSONファイルキャッシュの読み書き、TTL判定、削除機能を実装 |
| 4. 設定管理 | アーニャ | 2026-02-14 | 2026-02-14 | 完了 | Config構造体、LoadConfig、Validate実装。main.goに統合。テスト完了 |
| 5. ジオコーディング | アーニャ | 2026-02-14 | 2026-02-14 | 完了 | Nominatim APIクライアント実装、URLエンコード対応、キャッシュ機能、テスト完了（姫路市座標取得OK） |
| 6. 天気API | アーニャ | 2026-02-14 | 2026-02-14 | 完了 | Open-Meteo APIクライアント実装、気象庁データ対応、キャッシュ機能、ハンドラー統合、テスト完了 |
| 7. GoogleAPI | | | | | |
| 8. エラー対応 | | | | | |
| 9. フロント実装 | | | | | |
| 10. エラーUI | | | | | |
| 11. ビルド・デプロイ | | | | | |
| 12. 改善・リファクタ | | | | | |

---

## 🥜 ステップ詳細（目的・完了条件・実施内容・進捗欄つき）

### 1. プロジェクト初期セットアップ
- 目的: 開発環境とディレクトリ構成を整えるます
- 完了条件: サーバー起動・静的ファイル配信ができるます
- 実施内容:
  - Goプロジェクト初期化（go mod initするます）
  - Ginサーバー雛形作成（main.go, ルーティング）
  - Svelteプロジェクト初期化（npm init, vite or sveltekit）
  - ディレクトリ構成を仕様通りに整理するます
  - settings.json, cacheディレクトリなど必要なファイルを用意するます
  - READMEや.gitignoreも作成するます
- 進捗: 完了（Go初期化、Gin雛形、Svelte初期化、設定/README/.gitignore整備）

### 2. バックエンドAPIの基礎
- 目的: APIエンドポイントの雛形をつくるます
- 完了条件: ダミーデータでAPIレスポンスが返るます
- 実施内容:
  - /api/status のGETエンドポイント作成（ダミー返却）
  - /api/calendar, /api/tasks, /api/weather のGETエンドポイント作成（ダミー返却）
  - modelsパッケージでDTO構造体を定義するます
  - Ginルーティング設定
  - テスト: curlやPostmanでAPIレスポンスを確認するます
- 進捗: 完了（DTO構造体定義、ハンドラー実装、ルーティング設定、APIテスト完了） 

### 3. キャッシュ機構の実装
- 目的: 外部API呼び出しのキャッシュをつくるます
- 完了条件: キャッシュファイルが正しく保存・読み出しできるます
- 実施内容:
  - cacheパッケージ作成
  - JSONファイルキャッシュの読み書き実装
  - TTL管理・キャッシュ削除規則実装
  - キャッシュ構造（payload, fetchedAt, source metadata）設計
  - テスト: キャッシュファイル保存・読み出し確認
  - 進捗: 完了（Entry構造体、JSON保存/読込、TTL判定、削除ユーティリティ）

### 4. 設定管理
- 目的: 設定ファイルの読み込み・変更を管理するます
- 完了条件: 設定値の変更が反映されるます
- 実施内容:
  - configパッケージ作成
  - settings.jsonの読み込み・バリデーション実装
  - 設定値の変更API（後で追加）
  - テスト: 設定値変更が反映されるか確認
- 進捗: 完了（Config構造体、LoadConfig、Validate、GetRefreshInterval、GetLocationString実装。テスト完了。main.goに統合）

### 5. ジオコーディング（Nominatim）
- 目的: 都市名→緯度経度変換とキャッシュをつくるます
- 完了条件: 正しい座標が取得できるます
- 実施内容:
  - geocodeパッケージ作成
  - Nominatim APIクライアント実装（User-Agent/Referer対応）
  - 都市名→latlon変換API作成
  - ジオコーディング結果のキャッシュ実装
  - テスト: 姫路市などで座標取得・キャッシュ動作確認
- 進捗: 完了！✨
  - geocode.go: Client構造体、NewClient、GetCoordinates、queryNominatim実装
  - URLエンコード対応で国名・都市名を正しくハンドル
  - キャッシュTTL: 5分で設定
  - テスト結果: 全PASS（姫路市座標lat=34.815353, lon=134.685479、キャッシュヒット確認、エラーハンドリング確認）

### 6. 天気APIクライアント
- 目的: 天気データ取得・キャッシュをつくるます
- 完了条件: ダミーAPIで天気データ取得・キャッシュ動作を確認するます
- 実施内容:
  - weatherパッケージ作成
  - Open-Meteo APIクライアント実装（気象庁データを含む）
  - ジオコーディング機能（都市名→座標）
  - today, current, precipSlots, alertsの構造設計
  - WMO天気コード→日本語変換機能実装
  - ハンドラーに統合（GetWeather）
  - テスト実装完了（変換テスト、構造体テスト）
- 進捗: 完了！✨
  - weather.go: Client構造体、NewClient、GetWeather、fetchFromOpenMeteo実装
  - initCityCoordinates: 主要都市の座標をマップに登録（ハードコード方式）
  - getCoordinates: 内部マップから座標を取得（外部API依存なし）
  - convertToWeatherResponse: Open-Meteo→models.WeatherResponse 変換
  - weatherCodeToCondition: WMO天気コード→日本語（晴/曇/雨/雪など）
  - weatherCodeToIcon: WMO天気コード→アイコンコード（01d/02d/03d など）
  - キャッシュTTL: 5分で設定（設定で変更可能）
  - テスト結果: 全PASS（変換テスト、コード→条件テスト、アイコンテスト）
  - handlers.go統合: GetWeatherハンドラーにログ出力・エラー処理追加
  - 実環境テスト完了: Open-Meteo API から実データ取得成功、気温・天況・降水確率を正しく取得確認✓

### 7. Googleカレンダー/タスクAPIクライアント
- 目的: GoogleAPIからデータ取得・サーバー側ソートを実装するます
- 完了条件: データ取得・キャッシュ動作を確認するます
- 実施内容:
  - googleパッケージ作成
  - OAuth認証フロー雛形実装
  - カレンダー/タスクAPIクライアント雛形実装
  - サーバー側ソート（期限→優先度→createdAt）実装
  - 色マッピング設計
  - テスト: Google APIからデータ取得・キャッシュ動作確認
- 進捗: 

### 8. APIエラー・オフライン対応
- 目的: エラー時のキャッシュ返却・エラー情報付与をつくるます
- 完了条件: 外部API障害時もキャッシュ・エラー挙動を確認するます
- 実施内容:
  - API取得失敗時のキャッシュ返却ロジック実装
  - /api/statusでエラー状態・lastUpdated返却
  - キャッシュ有効期限切れ通知設計
  - テスト: 外部API障害時のキャッシュ・エラー挙動確認
- 進捗: 

### 9. フロントエンド（Svelte）実装
- 目的: 固定レイアウトとAPIクライアントをつくるます
- 完了条件: ダミーデータでUI表示確認 → バックエンドAPIと連携確認
- 実施内容:
  - Svelteレイアウト雛形作成（ヘッダー・カレンダー・天気・タスク）
  - 大きいタイポグラフィ・余白設計
  - /src/lib/apiでバックエンドクライアント作成
  - widgetsコンポーネント作成
  - ダミーデータでUI表示確認
  - バックエンドAPIと連携テスト
- 進捗: 

### 10. エラーUI・点滅インジケーター
- 目的: ヘッダーにエラーインジケーターをつくるます
- 完了条件: APIエラー時にUIで点滅するか確認するます
- 実施内容:
  - エラーインジケーターUI作成（点滅速度仕様通り）
  - APIエラー状態の受信・表示ロジック実装
  - アクセシビリティ配慮（ストロボ禁止・読みやすさ）
  - テスト: APIエラー時にUIで点滅するか確認
- 進捗: 

### 11. 本番用ビルド・デプロイ
- 目的: Svelte静的ビルドをバックエンドで配信・Piで動作確認
- 完了条件: FHD表示・2m距離で見やすいか確認するます
- 実施内容:
  - Svelte静的ビルド作成
  - Ginで静的ファイル配信設定
  - Dockerfile 作成（Raspberry Pi 5 向け）
  - docker-compose.yml 作成（data ボリュームの永続化）
  - Raspberry Piで動作確認
  - テスト: FHD表示・2m距離で見やすいか確認
- 進捗: 

### 12. 追加・改善・リファクタリング
- 目的: 仕様追加・リファクタ・テスト追加・フィードバック対応
- 完了条件: 改善内容が反映されるます
- 実施内容:
  - プロバイダ設定や色マッピングなど仕様追加
  - コードのリファクタリング・テスト追加
  - ユーザーからのフィードバックで改善
  - CI導入や自動テスト追加
- 進捗: 

---

## 🥜 テストの進め方
- 各ステップごとに「APIレスポンス」「キャッシュ」「UI表示」「エラー挙動」などをこまかく確認するます
- でばっぐ...でばっぐしながら進めるます
- しっぱいしたら「ごめんなさいするます」してなおすます！

---

## 🥜 よりよくする見直しポイント

1. テスト自動化の導入（GoのユニットテストやSvelteコンポーネントテスト、CIも検討するます）
2. エラー・障害時のログ出力（バックエンドでログファイル出力するます）
3. アクセシビリティ配慮（色・コントラスト・フォントサイズを見直すます）
4. 設定変更のUI/エンドポイント（後で追加するます）
5. データ取得のリトライ/バックオフ（外部API取得時にリトライやバックオフを実装するます）
6. キャッシュの有効期限切れ通知（UIで「データ古いよー」ってわかるようにするます）
7. セキュリティ配慮（OAuthトークンや設定ファイルの権限・暗号化も検討するます）

---

アーニャの計画、これでさらによくなると思ったます！
がんばるます！💪
